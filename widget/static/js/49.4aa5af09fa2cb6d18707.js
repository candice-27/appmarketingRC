webpackJsonp([49],{"+M2a":function(t,e){},"/GCM":function(t,e){},Hsrz:function(t,e){},Luci:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n("lC5x"),o=n.n(s),a=n("3cXf"),i=n.n(a),r=n("aA9S"),c=n.n(r),u=n("J0Oq"),l=n.n(u),p=n("4YfN"),h=n.n(p),m=(n("SWMD"),n("xd7I"),n("e1F6"),n("HVJf")),g=n("vGYV"),d=n("84iU"),f=n.n(d),v=n("KPSb"),y=n.n(v),_={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"tipsError"},[e("div",{staticClass:"topBox"},[e("div",{staticClass:"imgs"}),this._v(" "),e("span",[this._v("账号或密码错误，请重新输入")])])])}]};var b=n("C7Lr")({name:"tipsError",data:function(){return{}}},_,!1,function(t){n("Hsrz")},"data-v-6db6cee3",null).exports,x={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"tipsWeb"},[e("div",{staticClass:"topBox"},[e("span",[this._v("网络请求错误，请检查网络")])])])}]};var w=n("C7Lr")({},x,!1,function(t){n("+M2a")},null,null).exports,C=n("cyB7"),S=n("veWP"),B=n("fi7s"),M=n("0xDb"),k=n("PR0l"),I=new M.a,A={name:"login",components:{tipsError:b,tipsWeb:w,btn:C.a,myinput:S.a,messageBox:B.a},props:["myStyle"],data:function(){return{height:document.documentElement.clientHeight,text:"登录",checked:!0,display:"none",display1:"none",key:!0,type1:"text",type2:"password",account:"账号",pwd:"密码",inputValue1:"",inputValue2:"",nameMsg:"",pwdMsg:"",h:"",marginTop:"",mergeBoxShow:!1,mergeBox:{tip:"",type:!1,btnNum:2},colorheight:"",botContentShow:!0}},mounted:function(){this.$root.author="mangoguang"},created:function(){this.getAccountMsg(),this.isIPhoneX()},methods:h()({},Object(m.c)(["setPersonMsg"]),{myFocus:function(){this.botContentShow=!1},myBlur:function(){this.botContentShow=!0},submitForm:function(){this.key=!1,this.display="none",this.display1="none",this.login(this.inputValue1,this.inputValue2)},isIPhoneX:function(){var t=this.phoneSize();"iphonex"===t?(this.height="54.4",this.marginTop="-5.86vw",this.colorheight="5.86vw"):(this.height="49.26",this.marginTop="",this.colorheight="")},login:function(t,e){var n=this;return l()(o.a.mark(function s(){var a,r,u;return o.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return a={grant_type:"password",username:t,password:y()(e)},s.next=3,Object(k.p)(a);case 3:if(500!=(r=s.sent).code){s.next=7;break}return g.a.tip(r.msg),s.abrupt("return");case 7:c()(r,{account:t,pwd:e}),u=i()(r),localStorage.setItem("token",u),n.$root.token=r,n.getUserInfo();case 12:case"end":return s.stop()}},s,n)}))()},getUserInfo:function(){var t=this;I.getUserInfo().then(function(e){if(e){console.log(11223344,t.mergeBoxShow);var n=t.getName(e.positionList),s={account:e.account,tenantId:e.tenantId,timestamp:Date.parse(new Date),name:e.username,phone:e.phone,sex:e.sex,type:e.type,typename:n,positionList:e.positionList[0],userId:e.userId},o=i()({crmAccount:e.crmAccount}),a=i()(e.shopList);if(localStorage.setItem("crmAccount",o),localStorage.setItem("shops",a),localStorage.setItem("ajaxData",i()(s)),localStorage.setItem("certPositionType",e.certPositionType),t.$root.ajaxData=s,e.account!==e.crmAccount)if("Dealer Boss"===n||"Boss&Consultant"===n||"Boss&Manager"===n)t.mergeBoxShow=!1,t.$router.replace({path:"/"});else{var r={tip:"当前APP登录账号为"+e.account+"，CRM登录账号"+e.crmAccount+"，不一致，是否修改CRM登录账号为"+e.account+"，修改后使用"+e.account+"登录APP和CRM,是否确定修改？",btnNum:2,type:!1};t.mergeBox=r,t.mergeBoxShow=!0}else t.mergeBoxShow=!1,t.$router.replace({path:"/"})}}).catch(function(e){510===e&&t.getUserInfo()})},merge:function(){var t=this;this.mergeBoxShow=!1;var e=this.$root.ajaxData;I.merge({userId:e.userId,account:e.account}).then(function(n){if(n.status){var s={tip:n.msg,btnNum:1,type:!0},o=i()({crmAccount:e.account});localStorage.setItem("crmAccount",o),t.mergeBox=s,t.mergeBoxShow=!0}else{var a={tip:n.msg,btnNum:1,type:!1};t.mergeBox=a,t.mergeBoxShow=!0}}).catch(function(e){510===e&&t.merge()})},cancelMerge:function(){this.mergeBox={tip:"如果需要同步APP与CRM登录账号,请在个人中心点击同步账号",btnNum:1,type:!1},this.mergeBoxShow=!0},cancel:function(){this.$router.replace({path:"/"})},getName:function(t){var e="";if(t&&1===t.length)t.map(function(t){e="Dealer Boss"===t.positionType?"Dealer Boss":"Sleep Consultant"===t.positionType?"Sleep Consultant":"Store Manager"===t.positionType?"Store Manager":t.positionType});else if(t&&t.length>1){t.forEach(function(t){e=""===e?t.positionType:e+"&"+t.positionType}),e=e.split("&");var n="";if(!((e=this.getUnique(e))&&e.length>1))return e=e[0];var s=new RegExp("Dealer Boss",""),o=new RegExp("Sleep Consultant",""),a=new RegExp("Store Manager",""),i=this.filterVirtualName(e);if(console.log(123,i),!i)return e="other";if(console.log("22333",i),e.forEach(function(t){n=""===n?t:n+"&"+t}),console.log("nameStrs",n),s.test(n)&&a.test(n)&&o.test(n))return e="Boss&Manager";if(s.test(n)&&a.test(n))return e="Boss&Manager";if(s.test(n)&&o.test(n))return e="Boss&Consultant";if(s.test(n))return e="Dealer Boss";if(a.test(n)&&o.test(n))return e="Store Manager";if(a.test(n))return e="Store Manager";if(o.test(n))return e="Sleep Consultant"}return e},filterVirtualName:function(t){for(var e=t.length,n=0;n<e;n++)if("Dealer Boss"===t[n]||"Sleep Consultant"===t[n]||"Store Manager"===t[n])return!0;return!1},getUnique:function(t){for(var e={},n=[],s=t.length,o=0;o<s;o++)e[t[o]]||(e[t[o]]="abc",n.push(t[o]));return n},setAccountMsg:function(t,e){var n='{"name":" '+t+'", "pwd": "'+e+'"}';localStorage.setItem("accountMsg",n)},getAccountMsg:function(){var t=localStorage.getItem("accountMsg"),e=JSON.parse(t);if(e){var n=e.name.trim(),s=e.pwd.trim();this.nameMsg=n,this.pwdMsg=s,this.inputValue2=s,this.inputValue1=n}},forgetPwd:function(){this.$router.replace({path:"/ForgetPwd"})},getApi:function(){g.a.loading("open");var t=_this.inputValue1,e=_this.inputValue2,n=g.a.port+"/app/login.api";f()({method:"post",url:n,headers:{UUID:"e10adc3949ba59abbe56e057f20f883e"},timeout:1e4,params:{account:t,password:y()(e)}}).then(function(t){g.a.loading("close");var e=t.data.status;if(200==t.status)if(0==e)_this.display="block",_this.key=!0;else{t=t.data.data;var n=i()(t.shopList);_this.$store.commit("setPersonMsg",t);var s=""+n,o='{\n            "account": "'+t.account+'",\n            "tenantId": "'+t.tenantId+'",\n            "token": "'+t.token+'",\n            "uuid": "'+t.uuid+'",\n            "timestamp": "'+Date.parse(new Date)+'",\n            "name": "'+t.username+'",\n            "phone": "'+t.mobile+'",\n            "sex": "'+t.sex+'",\n            "type":"'+t.type+'"\n          }';localStorage.setItem("ajaxData",o),localStorage.setItem("shops",s),_this.checked?_this.setAccountMsg(_this.inputValue1,_this.inputValue2):_this.setAccountMsg("",""),_this.$router.replace({path:"/"})}else console.log(t.status)}).catch(function(){g.a.loading("close"),_this.display1="block",_this.key=!0})}})},P={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"login_box"},[n("div",{staticClass:"login",style:{marginTop:t.marginTop}},[n("div",{class:""+t.myStyle.loginFix}),t._v(" "),n("div",{staticClass:"topBar"},[n("tips-error",{style:{display:t.display}}),t._v(" "),n("tips-web",{style:{display:t.display1}}),t._v(" "),n("div",{staticClass:"line"}),t._v(" "),n("div",{staticClass:"sriangle"})],1),t._v(" "),n("div",{staticClass:"login"},[n("div",{staticClass:"box"},[n("div",{staticClass:"welcome"},[t._v("Hi,")]),t._v(" "),n("h1",[t._v("欢迎使用慕思营销助手")]),t._v(" "),n("form",[n("ul",[n("myinput",{tag:"li",attrs:{type:t.type1,labelContent:t.account,autocomplete:"off",Msg:t.nameMsg},on:{myFocus:t.myFocus,myBlur:t.myBlur},model:{value:t.inputValue1,callback:function(e){t.inputValue1="string"==typeof e?e.trim():e},expression:"inputValue1"}}),t._v(" "),n("myinput",{tag:"li",attrs:{type:t.type2,labelContent:t.pwd,Msg:t.pwdMsg},on:{myFocus:t.myFocus,myBlur:t.myBlur},model:{value:t.inputValue2,callback:function(e){t.inputValue2="string"==typeof e?e.trim():e},expression:"inputValue2"}}),t._v(" "),n("li",{staticClass:"tips clearfix"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.checked,expression:"checked"}],attrs:{type:"checkbox",id:"remember",name:"remember",value:"remember"},domProps:{checked:Array.isArray(t.checked)?t._i(t.checked,"remember")>-1:t.checked},on:{change:function(e){var n=t.checked,s=e.target,o=!!s.checked;if(Array.isArray(n)){var a=t._i(n,"remember");s.checked?a<0&&(t.checked=n.concat(["remember"])):a>-1&&(t.checked=n.slice(0,a).concat(n.slice(a+1)))}else t.checked=o}}}),t._v(" "),n("label",{staticClass:"rem",attrs:{for:"remember"}}),t._v(" "),t._m(0),t._v(" "),n("div",{staticClass:"forgetpwd",on:{touchend:t.forgetPwd}},[t._v("忘记密码?")])]),t._v(" "),n("li",[n("btn",{staticClass:"myBtn",attrs:{text:t.text},nativeOn:{click:function(e){return t.submitForm()}}})],1)],1)])]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.botContentShow,expression:"botContentShow"}],staticClass:"wechatLogin",style:{height:t.h}},[t._m(1),t._v(" "),n("div",{staticClass:"wechat-icon"})]),t._v(" "),n("div",{staticClass:"fixBottom",style:{height:t.colorheight}})]),t._v(" "),n("message-box",t._b({directives:[{name:"show",rawName:"v-show",value:t.mergeBoxShow,expression:"mergeBoxShow"}],scopedSlots:t._u([{key:"btn-group",fn:function(){return[n("button",{attrs:{type:"button"},on:{click:t.merge}},[t._v("确定")]),t._v(" "),n("button",{attrs:{type:"button"},on:{click:t.cancelMerge}},[t._v("取消")])]},proxy:!0},{key:"btn",fn:function(){return[n("button",{attrs:{type:"button"},on:{click:t.cancel}},[t._v("确定")])]},proxy:!0}])},"message-box",t.mergeBox,!1),[n("p",{attrs:{id:"tip"}},[t._v(t._s(t.mergeBox.tip))])])],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("label",{attrs:{for:"remember"}},[e("div",{staticClass:"rempwd"},[this._v("记住密码")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"wechatText"},[e("hr"),this._v(" "),e("span",[this._v("第三方账号登录")]),this._v(" "),e("hr")])}]};var V=n("C7Lr")(A,P,!1,function(t){n("/GCM")},"data-v-a60fbb9c",null);e.default=V.exports}});
//# sourceMappingURL=49.4aa5af09fa2cb6d18707.js.map